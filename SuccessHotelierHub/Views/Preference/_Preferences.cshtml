@model SuccessHotelierHub.Models.SearchAdvancePreferenceParametersVM
@using SuccessHotelierHub.Models
@{
    var sourceRedirectionParam = "";

    sourceRedirectionParam = (string)ViewData["Source"];

    var preferenceGroupList = (List<SelectListItem>)ViewData["PreferenceGroup"];
}

<form id="frmAdvancePreferenceSearch" name="frmAdvancePreferenceSearch" enctype="multipart/form-data" method="post">
    <div class="pt_10 pl_10 pr_10 searchBox_Border">
        <div class="row">
            <div class="col-md-4 col-sm-3 col-xs-12 form-group">
                @Html.LabelFor(m => m.PreferenceGroupId)
                @Html.DropDownListFor(m => m.PreferenceGroupId,
                            (IEnumerable<SelectListItem>)preferenceGroupList, "-- Select Preference Group --",
                            htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-4 col-sm-3 col-xs-12 form-group">
                @Html.LabelFor(m => m.Preference)
                @Html.TextBoxFor(m => m.Preference, new { @class = "form-control" })
            </div>
        </div>
    </div>
    <div class="col-xs-12 m-b-md padding-zero">
        <div class="pull-right m-t-sm">
            <button type="button" class="btn btn-success m-r-xs" id="btnSearch" onclick="searchPreference()">Search</button>
            <button type="button" class="btn btn-danger" id="btnClear" onclick="clearPreferenceSearch()">Clear</button>
        </div>
        <div class="clearfix"></div>
    </div>



    <div class="table-responsive m-t-md" style="min-height:225px; height:225px;">
        <table class="table table-bordered table-hover table-striped" id="tblPreference">
            <thead>
                <tr>
                    <th></th>
                    <th>Preference Group</th>
                    <th>Description</th>
                    <th>Preference</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="col-xs-12 text-right m-b-md padding-zero">
        <hr class="hr_margin" />
        <button type="button" class="btn btn-primary m-r-xs btnAdvanceSearchPreferenceOk">Ok</button>
        @*<button type="button" class="btn btn-success m-r-xs" onclick="addNewPreference()">New</button>
            <button type="button" class="btn btn-warning m-r-xs" onclick="editSelectedPreference()">Edit</button>*@
        <button type="button" class="btn btn-danger m-r-xs" data-dismiss="modal">Close</button>
    </div>
</form>



<div class="clearfix"></div>

<script type="text/javascript">
    function searchPreference() {
        $.ajax({
            beforeSend: function (xhr) {
                showLoader();
            },
            error: function (result) {
                showToaster(result.responseText, ToasterType.ERROR);
            },
            complete: function () {
                hideLoader();
            },
            url: '@Url.Content("~/Preference/SearchAdvancePreference")',
            type: 'POST',
            data: $('#frmAdvancePreferenceSearch').serialize(),
            success: function (response) {
                if (response.IsSuccess == false) {
                    showToaster(response.errorMessage, ToasterType.ERROR);
                }
                else {
                    //Show data in table.
                    var result = response.data;

                    $("form#frmAdvancePreferenceSearch #tblPreference tbody").empty();
                    var tbody = $("form#frmAdvancePreferenceSearch #tblPreference tbody");

                    var markup = "";

                    if (result.length > 0) {
                        //Add the data rows.
                        for (var i = 0; i < result.length; i++) {
                            markup += "<tr>";

                            markup += "<td><input type=\'checkbox\' class=\'chkPreference cursor-P\' id=\'chkPreference_" + result[i].Id + "\' name=\'chkPreference\' value=\'" + result[i].Id + "\'  data-preferencegroupname=\'" + result[i].PreferenceGroupName + "\'  data-preference=\'" + result[i].Preference + "\'/></td>";
                            markup += "<td>" + result[i].PreferenceGroupName + "</td>";
                            markup += "<td>" + result[i].PreferenceGroupDescription + "</td>";
                            markup += "<td>" + result[i].Preference + "</td>";

                            markup += "</tr>";
                        }
                    } else {
                        markup += "<tr><td colspan =\'4\' class=\'text-center\'>No data available.</td></tr>";
                    }

                    tbody.append(markup);
                }
            }
        });
    }

    function clearPreferenceSearch() {
        $('form#frmAdvancePreferenceSearch #LastName').val('');
        $('form#frmAdvancePreferenceSearch #FirstName').val('');

        $("form#frmAdvancePreferenceSearch #tblPreference tbody").empty();
    }


    function addNewPreference() {
        var url = '@Url.Content("~/Preference/Create")' + "?source=@sourceRedirectionParam";
        redirectTo(url);
    }

    function editSelectedPreference() {
        var selectedPreference = $('input[name=chkPreference]:checked', '#frmAdvancePreferenceSearch');

        if (selectedPreference.val()) {
            var preferenceId = $(selectedPreference).val();
            var url = '@Url.Content("~/Preference/Edit")' + "?id=" + preferenceId + "&source=@sourceRedirectionParam";
            redirectTo(url);
        } else {
            showToaster("Please select any one preference.", ToasterType.ERROR);
        }
    }

</script>